# $ = require 'jquery'
# _ = require 'lodash'
# Backbone = require 'backbone'

#文件视图
exports.FileItemView = Backbone.View.extend
	initialize:( options )->
		#初始化逻辑
		this.listenTo this.model, 'destroy', this.remove

	events:
		'click .img':'showBigImg'
		'click .delFile':'delFile'
		'click .downloadFile':'downloadFile'
		
	#渲染文件视图
	render:()->
		self = this
		reg = /.*\.((jpeg)|(jpg)|(png)|(gif))/g #如果是图片才能点击查看大图
		rlt = reg.exec( self.model.get 'fileName' )
		isImage = rlt? and rlt.length
		return """
			<div class="file-item-container">
				<img class="#{if isImage then 'img' else ''}"></img>
				<div class="fun-container">
					<span class="fileName"></span>
					<input type="button" class="delFile" style="#{if ( readonly? and readonly ) then 'display:none;' else '' }" value="删除"/>
					<input type="button" class="downloadFile" value="下载"/>
				</div>
			</div>
		"""
	
	#查看大图
	showBigImg:()->
		self = this
		layer.open
			type:1
			content:'#big-img-container'
			area:['800px','600px']

	#删除该条数据
	delFile:()->
		this.model.destroy()

	downloadFile:()->
		$.ajax
			url:'http://' + this.model.src
			method:'GET',
			contentType:'application/octet-stream'